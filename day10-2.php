<?php

$input = [
    '{{(([<((({<(<<[][]>({}[])>[(<>[])(<>{})])<<[<><>][<>()]><([]{}){<>()}>>>}){<[[{<[]()>}{((){})[<',
    '((<(<{{<({<<{[{}()]}(((){}){[]()})><[[()()]<(){}>]{<[][]>{[]<>}}>>}){(<<<<<>{}>>[([]())]>[<{{}()}[()]>{[{}',
    '[{[<(<(<{<{[((()[])[<>{}])][((()<>)[<><>])]}>([<{<{}{}>[{}<>]}[[[]<>]<()<>>>>{[(<>())(()[]',
    '(<{(<{<{<<<[[{[]{}}<()[]>]({[]<>}<(){}>)]>[{<[()()]<()<>>>({[]<>}<()[]>)}]>({[{(()){{}()}}',
    '{[<(<[[(([{{{([]{})[{}{}]}{([][])([]<>))}<<<()()>(()[])><[[]<>]{{}<>}>>}[<<({}())[<>[]]><[{}{}](<>',
    '<[(<{[<{([({<(()[])>([{}[]]{()()})}[[[[][]]((){})]{{{}{}}<()<>>}])[{{[{}[]]{[][]}}}{({[]()}(()<>))[<{}()',
    '[((<[(((({<{[([]<>)({})]<[[][]](()())>}([{[]}([]())](<{}>))><<[[<><>]<()()>]<<()[]>[<>{}]>>>}))(',
    '[{[(<<<<{<<<[{<><>}{(){}>](([]()))><([<>[]]{()()})[[<>[]]{()[]}]>>([[{()[]}{{}<>}]{<[]<>>{[]()}}]',
    '{[[[<([[{[[({{()<>}<()<>>}{(()<>)<<><>>})<[{(){}}(()<>)]{{<><>}<{}()>}>][([(()())[{}()]]<<<><>>',
    '[[[[{{<{<[<[{{[]{}){()()}}]{([(){}]<[]<>>){[{}()]}}>[{{<[][]>(()<>)}}{{<[]<>>{<>()}}([[][]][{}[]])}]]>}[[',
    '{{<({[([([<{{{[]()}(<>[])}({[]<>}({}<>))}{<<<>()>({}<>)>[[{}<>](<>())]}>][{<[[(){}](()<>)]',
    '[{([<<<[[({[<[<>[]]>{(()<>)([]())}]}]]{<<<<[[]][{}]><<[]()>{<>()}>><<(<><>)(()<>)>([{}<>]{{}()})>>>{{',
    '<<[<(({{[(<{{((){})([]<>)}({{}<>})}>[[<<{}<>><()<>>>(<()()>[[]()])]([[{}{}]{[]<>}])]){<{(<()[]>{<>()})<([]<>',
    '([({({[{{<(<([<><>]{{}[]})<{<>}({}())>><<{[]{}}<()>>{{<>()}({}{})}))>[[{{{<>()}{(){}}}{{<>[]}',
    '<({[[<[<{[<([[<>{}]<()[]>){{[]()}[<><>]}){<<()<>>{{}<>}><[{}{}]{{}[]}>}><[<<<><>><[]<>>>{{()()}<[]<>>}]',
    '[[{<([{(<[{{([<><>])[[{}()][()()]]}(({<><>}{{}{}})((<>())[{}[]])>}<(<[()()]>)<<<[]{}>[[]()]>[',
    '{[{((<({<{({{{[][]}{[]{}}}<{(){}}<[][]>>}{<<[]>[[]()]><[[][]]<(){}>>})(<[({}[])(()[])]<([]())',
    '<[{<{<<[[[([<[[]{}]{[]<>}>(({}{})((){}))]{((<>[])<<>[]>)<{()[]}<<>()>}})<<[[[]()][{}{}]]{({}<>)<<>{}>}',
    '{<{[[(<(({<({<{}()>({}{})}[{[]()}{<>()}))[<[[]<>](<>())>]>}){([{([{}<>]{()<>})((<>{})<()>)',
    '{[(([{{[({{[(([][])[()()]){{<>{}}}]({<<>()><<>()]}(<[][]>(<>[])))}<[([[]()]{(){}}){(<>{})[[]()]}]>}[{<[[<>{',
    '(([(<(<<{(([(<()><[]{}>){(<><>)[{}[]]}][([[]{}])(<[]()>[{}<>])]))[({<{[]()}>{{[]()}<()[]>}}[{',
    '{(<<<[[[<[<<<[<>[]]<[][]>><{<>{}}(<>)>>[{[()<>][{}[]]}{{<><>}<[]{}>}]>([[{[]()}][[()<>]([]())]]',
    '<(({{{<[{[([{{()()}[{}()]}<{(){}}[<>[]]>])[((({}[])<[][]>){[{}[]][{}<>]}){[<[]()>[<>{}]]([{}()]((){}))}]]<<{(',
    '<{{{(<[[<({{([<><>]){<[]<>><<>()>}}[[(()<>)<[]<>>]{([]())[(){}]}]})({([(()<>)[[]()}][{(){}}{<><>}])(((()()',
    '<{<[{<[{{({{<[()<>]<[][]>>}}{<<<<>>({}{})>[<[]<>>]>((<{}<>>{<><>})[{[]}[{}()]>)})}}]>[(<(<<<{([]{})({}<>)}(',
    '(<[[{[{[[{[[{<[]<>>(<>())}{[<>{}><(){}>}]<[<<>[]><[]()>]{[[][]]<{}{}>}>]{{{<<>()>{<>()}}}<<',
    '(<<{{[({({[[[({}()){(){}}]]{<{<>}<()<>>>(<{}()>[[][]])}]{{{{<><>}(<>)}{{(){}}[()()]}})}){(<<[([][])<[]{}>',
    '<({[<<{<<{{([<{}{}>{()[]}](<()<>><{}{}>))[{{{}<>}}<<<>[]>[{}{}]>]}[({<[]()>}{{{}[]}})]}>[<[<',
    '<{[(({{[(<[(({{}<>})((()<>)))(<{()()}[[]()]>)]><({{({}{})[<>]}([{}<>]{()[]})})>)(<(<<((){})[()<>]>{([]',
    '({<((<<(({([[[[]()]{{}<>}}([<>()]{{}[]})]<([<>{}]{<><>})>)[[{<[]<>>((){})}{([]())<{}<>>}][[<<>',
    '({{{[<{(<[({({[]()}{<>[]}){(()[])({}{})}])(<[(()<>)]>({<()>{{}{}}}<(()[])[()[]]>))]{{[(((){}){{}{}})',
    '{{{<{<{[((<{[<(){}><{}<>>]}>)}]}({{<((<<<>{}>>{<[]()>({}())})(<([])<[]{}>>{(<>())([][])})){<',
    '<{({{(<[[<({((<>{})[()()])(<()()>[<><>])})(<[{[]{}}<{}{}>]({[]{}}{[]<>})>(<[{}[]]{<>()}><{{}[]}((){})>))',
    '[(<[[(<([[({[{<>()}{[]<>}](<<>{}>[[]{}])}[{[{}<>]{()[]}}<<{}()>{<>()}>])[((<()<>>{[][]})<(<>()',
    '[{[<{{[({[(({[{}[]]<{}<>>}{([]<>)<[]{}>})[{[[]()]{[]()}}<[{}()]{<><>}>])([{{{}<>}{<><>}}({{}()}{<>[]}',
    '<[[<[((({([[({<>()}{<>[]})]{{<(){}>[()[]]}{<[][]>[(){}]}}])}{{((<<{}[]>([]{})><([]{})[<>()]>)){',
    '({<{<<(<{([(<[{}{}][{}[]]>)([([]()){<>[]}]<{()()}<()<>>>)])[<[[{{}{}}][{{}[]}{{}{}}]]{[<[][]><<>()>]<[{}()]{',
    '(({<<{<([{{{[<()<>>([][])]{(<>())<<>()>}}<[<<><>>]{<()[]>}>}{[{[{}{}][()()]}{<{}{}>{{}<>}}]{[{[',
    '{[{[<{(<{(<({((){}){<>[]}}([()<>]<{}<>>)){(<()[]><<>>)(<()<>><{}[]>)}>([(([]())[()[]])]<[<{}{}><()[])][',
    '({[{({((<<<(<<<>>>{{{}[]}<<><>>})>[([([]<>){{}[]}>{{()()}({}{})})[{({}{})(<>[])}]]>[(<({[][]})<[<>[]]',
    '[[{{<<(<[([{({()<>}[{}()])({<>()}<<>()>)}])][{([<<<>()>{[]{}}>]([[{}<>][<>[]]]({<><>}{()[]})))([[({})<',
    '[<{<({[<{[[[<<(){}>>{[()()](<>[])}]][(({[]{}}{()[]})){<{()<>}[[]{}]>({()()}(<>{}))}]]{<[<{[]{}}>](<[[]{}]{{}[',
    '<<[[<((<<[([([()[]]{[][]})({{}{}}{<>()})]<[{<><>}[<>()]]{[[]{}](()<>)}>)<<{<()<>>{[]()}}{{[]{}}[[]{',
    '{[[([([[{<[[[<()[]><{}>]{({}[])(<>{})}]<<(<>[]){[]<>}>[(<>{})(()<>)]>]({((()()){[]<>})[<[]{}><{}()>]}{{(()[',
    '[{{{([<(<(({{<()[]>{()()}}[<<>()>{{}()}]}<<([]<>)[<>()]>(<()<>>{<><>})>)({[{[][]}{[][]}]<<<>',
    '<(<(((<([{{(<{<>[]}[()[]]>[<{}{}><<>()>]){({<>}([]<>))<{{}<>}[()<>]>}}}(<([[[]<>]]((()<>){<><>})>[<{<>[]}[<>',
    '<<[<[[<(([({[{()()}<()[]]][{{}[]}<<>[]>]}[[[()<>]]([{}()]([]))])]{([[<[][]>[{}{}]]<({}{}){[][]}>])[<[[[][]](',
    '[({<{{{([[(({[<>[]]}{<<>()>[(){}]})[<[<>()][{}]>{(()())}]){{[{<>{}}]{[{}](()())}}{[[<>()][<><>]]}}]](<<[{{{',
    '{({{[[({<([{[<<>[]>]<<{}[]><[][]>>}({(()<>)<<><>>}[[{}<>][[][]]])]<[<{()}{<><>}>]({{[]<>}[{}()]}<({}(',
    '(<<<{(({[[(<<<<><>>{<><>}><<{}[]><[]>>>(<({}()){[]{}}>[{<><>}([]{})]))<<([{}()][[]{}))[<<>>[[]()]]>',
    '(<<({{<({<{<[[<><>]]<<<><>>[[]<>]>>(<{{}()}[()]><<(){}>(()<>)>)}[[<[[]()]<<><>>>[({}()){()[]}]][<[<>{}](()[',
    '([[({[[{([[{<([]{}){{}()}>{(<>[])}}[(([]{}){()()})]][<<([]{})([]())>>[((()<>))<(()<>)[[]<>]>',
    '([({{({{<{((<<()[]><<><>>><{{}[]>[<>[]]>)<({()<>}[<>{}])[{()[]}[[][]]]>)<([<()()>({}{})](<[]()>))<[[[]()]<(',
    '<<<<[(<({<[<[(()()){<>()}]<[<><>]{[]{}}>>]>([[{<()>{[][]}}](<[()[]]<<><>>>([<>()]<{}[]>))]{<{{<',
    '[[<{<([<(({{<<{}<>>>{<<>[]>(<>[])}}})[{[{<<>{}>(()[]]}]}])>][{(<<({[[][]]{{}<>}}<({}{})({}',
    '([<([<((<<<<({<><>}[<>[]]){{()()}(<>{})}><[({}<>)[()()]])>[<<[()]<<>[]>>>]>[([{{<><>}{{}{}}}([[]()]',
    '(<<<((<[(<({[{[]<>}[{}{}]]<(<>())[()<>]}})>)[{({[<()<>><{}{}>][[[]<>](<>[])]}[([()()](()[]))<({}{})(<>',
    '<(<[(({[(([<[[()<>]{<>{}}]((()[]){[]{}})><<({})(<>)}[[[]()][<>{}]]>]<{[<()><()()>]<<{}{}>[{}()]>}>',
    '<<[<{<<(({<<((<>{})[[]{}])[{()()}{[]<>}]>{((<>()))[{<>[]}]}>({<<[][]>(()())><<[]<>>{[]{}}>}<({()()}<{}',
    '<{{<([{[{<([([[]()]<[]>){[()[]][(){}]}]<[{{}()}[{}[]]]>)({[<{}<>>]((<>[])<{}{}>)>{({{}{}}({}<>)){{{',
    '{[{{(<[[(<[(((<>[])[()[]])([()()]<()<>>)){[{[][]}[<>{}]]}]><{<((()<>)(<><>))<<()<>>(()())>>{[<[]()>]{((){})<',
    '(((<<<[<<<<[(([]{})[[]()]){[(){}]}][{<<>()>{{}<>})<(<><>)([][])>]><{<[{}<>]{()[]}><<<><>>(',
    '[<([<(([([(<<[[]<>]>{<<>()><(){}>}>{{{<><>}]<{<>[]}{<><>}>}){[{[{}{}][[]()]}]<([{}()][()()]){([][])[()<>]}>}',
    '[[(<[([<[{(<[<{}()><{}[]>][({}[]){()<>}]>[{[[][]]<[]()>}<{()<>}(()[])>])[[{({}{})<()>}([{}<>][{}])]]}({({{[',
    '[<{{<{[[[<([<{[]{}}{[]{}}>{{{}()}([]{})}]]{[{<()()>[<>[]]}[[<>()][<>()]]]([<[]<>>(()[])]{({',
    '<(<(<({[{((([<[]<>>])<[({}{})(<><>)][[<>{}]<()[]>]>))}<{{<(([]<>){{}{}})>}<<({{}{}}({}())){[(){}]{<><>}}><(',
    '((<{<[<{([[[([[][]]{{}())){<{}{}><<>()>}]][[(([][])[()<>])]]])[<({((()<>){[]{}})[<{}><()[]>]',
    '[[{<[{((([<[(<()<>>){((){})(()())}]{[[{}{}][[]]]}>]((<{{<>[]}<<><>>}[[<><>]<{}[]}]>){[[[()]',
    '{[<<<[(<{[[[<{<><>}(<>{})><[[]{}]<()<>>>]{{[()[]]<[]<>)}[<()<>>(<><>)]}]]}>([[{({([]<>)}<[()<>]{(',
    '<<[<([[<{([(<([]{})[{}[]]><<()()>{()()}>)({[{}()]<<>()>}({[]}({}<>)))]){({<[<>[]]{<>()}>}){{{{()<>',
    '[([(<[[{[{[[<<{}()><{}<>>>(<()[]><()>)]][<{[(){}]{()()}}(<<><>>[[]{}])>]}](<<<(<{}[]><()()>)<{{}',
    '{[({([[<<[[[([(){}](()<>))]][(({{}()}([]))[{[]()}{[]{}}])<<({}<>)>(<[][]><(){}>)>]](<((<[]{',
    '(<(([(<<[([({{()<>}([][])}<([]{})>)<{<<>{}>}[<[][]><<>()>]>][(({()[]}[()[]]){{{}{}}{<>()}})[(({}[])<[]>)({()}',
    '{[<<{<((<{[({{[]}{()}}[[()()]{[]<>}])<<[()<>][()<>]>({<>()}<()[]])>](<{<()<>><()>}[[()()]]>)}<{[<[[][',
    '<[<{<{([({[<{({})[[]<>]}[(()<>)<<>()>]>[[{<>()}[()()]]<[{}{}]<<><>>>]]<{[{()[]}]{(<>{})([]<>)}}({[[]<>]<{}{',
    '{{<[{{<[[<{{{{<>()}{(){}}}(<[]>)}}[[<{[][]}{<>{}}>[(<>{})(<><>)]]([{()[]}((){})][{(){}><()[]>])]>]{([(',
    '{([({([<({{[[<{}{}>{<>{}}}([[]()]{(){}})](<{{}[]}[<>[]]>[{()()}(<>)])}[([<<><>>{[]()}]((<>()){()<>}))[<[<>[',
    '<({[({<<<[[{<<{}[]>{[]<>}><({}())(()[])}}([[{}[]][<>()]][<{}<>>])]]>>>}{([[(([[<<><>><<>()>]]{{({}[])',
    '[([[(<{[[<{(([[]<>])[{()()}[[]()]])}[<<<<>[]><()[]>>><[(<><>)[{}{}]]<[<>{}]<()[]>>>]>{(<<([][])[<>]>{(<>{})[',
    '{[(<{(([<[{({({}{}){()()}}<[<><>]<{}()>>){(({}[]]{{}<>}){([]{})}}}<[[({}<>)]{[[][]]<()<>>}][[[[]{}]{[]()}]]>',
    '[<(({[{{[{<(((<>{})<<><>>)<{[][]}>){(<[]()>{<>{}})[(<>[])[()<>]]}>[<(({}<>)[<>[]])[{<>[]}(()<>)]>({<[]<>>}[',
    '(<({<({([({[{{{}{}}(()<>)}<{<>()}(<>[])>][[{[][]}{<>{}}]{{()[]}{()<>}}]}{<({[]{}}<()<>>)>({({}())[{}()',
    '{{[<[{{<<[(<<<<>()>>([<>{}])>)([<{[]()}{[]{}}>][[(<>[]){[]{}}][<<>[]><()()>]]>][<<[{[]}({}())]{[<>{}]([',
    '<<<<{({[[[[[{<()<>>{{}<>}}{{[]{}}((){})}]{[{(){}}[[]{}]]{<<>()>(()())}}]<(<[()<>]{()}>[[[]<>](<>[])])(((',
    '{<[([<{<<<<{((<>{})<()()>){([]())[()[]]}}>><<<(<[]()>(<><>)){<<>[]><[][]>}>[[<()<>>(()<>)]',
    '[<(<([{{<<{<<({}())><<{}<>><{}<>>>>}{([[[][]]({}{})])}>><([[[{[][]}{<>()}]][([[][]][()[]])<<{}',
    '({(({(<{([{<[(()())<{}<>>]>[<(<>())[<>[]]><([]<>)[()<>]>]}][{(({<><>}([]())))}]>}[[{<{<[()()][<>{}]>{({}<>)}',
    '[{[<<<{(<[<({({}<>)}{{()<>}([]())})<(<()<>>[[][]]){<<>()>}]>]{(<[{(){}}<<>{}>]{{{}[]}<(){}>}>{[([][]',
    '(<{<[{<((([[{[{}[]][<>[]]]{[()()][{}{}]}]([<()[]>{<>{}}])])[(<{[<><>]{<>{}}}><<([][])>>){[{({}<>)<{}',
    '{({[<[([{[[[[([]()){{}<>}][<{}[]>{{}[]}]]([{{}{}}{{}[]}]<([]<>)>)]<([<[]()><(){}>](<()<>>(<>{})))>]',
    '{{{<<({(<[[{{[<>{}]}<({}<>)<[][]>>}(<{()()}[()<>]><{{}[]}[{}[]}>)](<{{<>()}<[][]>}>)][<(<<<>>([]())>)[{<<>()>',
    '[([[{[(({(<[{(<><>){{}<>}}{(<>[]){[][]}}]{(({}[]])(<[]{}>({}[]))}>[(<{<><>}{<>()}>[({}())<[][]>])[{<{}{}>',
    '{({{[<<{<<[<{{[]{}}([])}>([(<>{}]<{}<>>][<<>[]>{<>}])]{<[{(){}}{[]{}}]<<()<>>[{}]>>([{()()}<{}<>>',
    '{[{<[([<((([[(())[{}<>]]<<<>{}>{<>[]}>](([[]{}]{[]{}}){[()]})){<<[[]()][[]()]>(<<>{}>[()[]])><<<<>',
    '<[([[<{{([([(<[][]>[(){}])((()[])(<>))][[[[]<>][{}()]][<[][]>{<>()}]])<[[<()()>(()())}[<[][]>[()()]]]{<{[]{}}',
    '{(({(<{({[[({{<>()}[()()]}[{[]<>}[[]<>]])([({}{})<{}()>]((()<>){()()}))]][{<({{}()}(<><>))[<(){}><()[]>',
    '[{[[([[<[<[(<<[][]>[<>[]]>{(<><>)<[]<>>}){((()())[()]){[<>{}]<{}[]>}}]><[[{(()[])<()<>>}][[<<><>>',
    '[<({({<[[<[{{({}{})<<><>>}<{()[]}{[]<>}>}[[{()()}]<[()()){{}()}>]][[<[<>()][{}[]]>{[{}<>](<>{})}]{{(<>())(<',
    '(<(((({[[<<{<{()()}<<>[]>>}[([[]{}]<<>()>)]><[<[{}[]]{{}{}}>{<<>{}>{{}()}}]>>({({<(){}>({})}([()<>]{<><>}',
    '<{({<<(([<({[{[]()]]<[<>()]<<>{}>>})((<<[]<>>(<>{})>)[[[<>{}]([][])](({}{})<[]{}>)])>](<[({{()()}([]',
    '<[({[{[[[[[<[[<>()}([])]([()()]<<><>>)>[{{<>{}}[()]}{{<>[]}<<>{}>}]]{[<{()<>}([]<>)>({{}[]}<()[]>)]}]<',
    '[(({(<((({{[((()[]){(){}})([[]{}][{}()])]}<{{(<>()){[]()}}<([]())[()<>]>}<<(<><>)([][])>[{()[]}<<>[]>]>>}[{',
    '{([<{({[<{{{[[[]<>]]}(<([]<>)<<>{}>>({{}<>}(<><>)))}}>][{[<[{([]<>){<>{}}}(([][]){[][]})]>(({(<>{}){{}[]}}',
    '(<[([<{<(<([[{()<>}][{{}<>}(()())]]<([[]()]{[]<>})>)>[<<<<()<>>(()())>{{()<>}<<>{}>}><((<><>))>>({{{[',
    '<{([<[[{<<((<{{}()}<()()>>[<<>[]>{<>()}]]){({[{}](()<>)}<(()[])<()[]>>)[[[{}[]]({}[])]{{[][]}({}[]',
    '{{([[<(((([(([{}()][{}<>])<([]())>)[[[{}[]]([]{})]]]([[(()<>){<>[]}][[[]{}}<()[]>]]{[{{}[]}{',
];

$openings = ['<', '{', '[', '('];
$closings = ['>', '}', ']', ')'];
$simplePairs = ['<>', '{}', '[]', '()'];

$rewards = [
    ')' => 1,
    ']' => 2,
    '}' => 3,
    '>' => 4,
];


function cleanUpRow($row, $simplePairs) {
    $replacedString = $row;
    $hasPossible = true;
    while ($hasPossible) {
        $found = false;
        foreach ($simplePairs as $pair) {
            if (strpos($replacedString, $pair) !== false) {
                $replacedString = str_replace($pair, '', $replacedString);
                $found = true;
            }
        }

        if (!$found) {
            $hasPossible = false;
        }
    }

    return $replacedString;
}

function getMissingClosings($row, $closings, $openings) {
    foreach ($closings as $cChar) {
        if (strpos($row, $cChar) !== false) {
            return [];
        }
    }

    $mClosings = [];
    foreach(str_split($row) as $rChar) {
        foreach ($openings as $index => $fOpening) {
            if ($fOpening === $rChar) {
                $mClosings[] = $closings[$index];
            }
        }
    }

    return array_reverse($mClosings);
}

$incompleteRows = [];
foreach ($input as $signal) {
    $cleanedRow = cleanUpRow($signal, $simplePairs);
    $mArr = getMissingClosings($cleanedRow, $closings, $openings);
    if (count($mArr) !== 0) {
        $incompleteRows[$signal] = $mArr;
    }
}

$sums = [];
foreach ($incompleteRows as $iArr) {
    $rowSum = 0;
    foreach ($iArr as $foundClosing) {
        $rowSum *= 5;
        $rowSum += $rewards[$foundClosing];
    }
    $sums[] = $rowSum;
}

usort($sums, function ($a, $b) {
    return $a <=> $b;
});

echo("Middle sum: " . $sums[(count($sums) - 1) / 2] . PHP_EOL);